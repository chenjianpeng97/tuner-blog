# 测试框架开发

## 需求梳理

- 目前俺在一家中小型B2B公司研发团队工作，团队技术氛围没那么浓厚，对文档也不是很重视的，那么自然的，测试想去找postman apifox文档下直接写用例有点是不可能的，因为那样要求开发会即时把接口变更放到接口文档工具上并提测，并且有足够的CI环境把接口用例放在CI中检测未更新接口文档的发版
- 那么俺在这样的团队中如何实施接口自动化呢？第一个困难就是获取这个文档，如上一条所说的，如果文档编写和维护工作后端干好了那自不必说，测试当然很轻松啦；但可惜目前没有，所以俺准备通过抓包的方式去获取这些文档，那么我们有了测试框架的第一个需求:能够抓包生成测试代码!
- 接口测试工作可以分为两种,接口单元测试与接口集成测试；区别是接口单元测试要拿单个接口当黑盒，测试A输入是否得到期望的B输出；接口集成测试是通过接口实现的功能测试，通过测试数据构造，接口获取，接口编排，结果断言来实现；那么既然本框架要承担接口文档生成的工作，最好是能用最小的成本把这两件事都干了；俺接下来准备抄一下apifox的设计思路，文档+调试+接口编排+前后置操作fixture作为生成接口的.py表达的定义，再操作这些定义实现接口单元测试与接口集成测试的编排
- 接口单元测试部分，俺应在设计apimodel.py这个模型时，就可以用写模型的方式将一些前置操作和断言放到model定义中，这样通过断言逻辑来增强这个接口的业务意义表达，实现apimodel这个设计的接口文档作用的目的
- 接口集成部分，接口编排的大部分操作都应交给成熟的框架或util，如变量的提取与存储应该由pytest来管理，一些数据库操作应由pymysql来管理，框架应完成的是util的封装，但不作为core部分

## 实现

- core部分
- reocord cli部分
- util部分
- ai增加单元测试
- 通过apifox echo做集成测试

## 问题解决记录

- AssertOperation好像出了问题，虽然通过了单元测试，但是实际应用到业务系统中body.json返回值$.code == 200确实也是200，不过框架就是给抛assertion error;很头痛，写一个集成测试看一下原因
- 集成测试用apifoxecho来做外部依赖，俺认为极狐的技术力是可以的，产品也很好用，俺就不自己写mock来测试了，虽然这样的外部依赖更像是system test
- apifoxecho功能还是很全的，先去让俺自己的测试框架能跑通http方法下的接口，测试一下AI给我写的这些前后置操作类
